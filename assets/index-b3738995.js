(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function d(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=d(a);fetch(a.href,s)}})();const u=document.getElementById("imageInput"),l=document.getElementById("imagePreview"),I=document.getElementById("watermarkInput"),m=document.getElementById("watermarkPreview"),p=document.getElementById("watermarkOpacity"),v=document.getElementById("watermarkSize"),k=document.getElementById("applyWatermark"),B=document.getElementById("exportButton");l.addEventListener("dragover",D);l.addEventListener("dragleave",x);l.addEventListener("drop",W);l.addEventListener("click",function(){u.click()});u.addEventListener("change",function(e){const t=e.target.files[0];E(t)});I.addEventListener("change",function(e){const t=e.target.files[0];P(t)});p.addEventListener("input",S);v.addEventListener("input",O);k.addEventListener("click",R);B.addEventListener("click",function(){const e=document.querySelector(".main-image").src;console.log("mainImg",e),u.files[0]||e?q():alert("Загрузите изображение и примените водяной знак перед экспортом.")});function D(e){e.preventDefault(),l.classList.add("drag-over")}function x(e){e.preventDefault(),l.classList.remove("drag-over")}function W(e){e.preventDefault(),l.classList.remove("drag-over");const t=e.dataTransfer.files[0]||u.files[0];t&&E(t)}function E(e){if(e&&e.type.startsWith("image/")){const t=new FileReader;t.onload=function(d){const n=new Image;n.src=d.target.result,n.classList.add("main-image"),n.style.maxWidth="100%",L(l,n)},t.readAsDataURL(e)}else alert("Выбранный файл не является изображением.")}function L(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(t)}function h(e){const t=m.querySelector("img");Object.assign(t.style,e)}function P(e){if(e&&e.type.startsWith("image/")){const t=new FileReader;t.onload=function(d){const n=new Image;n.src=d.target.result,n.style.opacity=`${p.value/100}`,n.style.width=`${v.value}px`,L(m,n),C()},t.readAsDataURL(e)}else alert("Выбранный файл не является изображением.")}function C(){const e=m.querySelector("img");let t=!1,d,n,a,s;e.addEventListener("mousedown",o=>{t=!0,a=o.clientX-d,s=o.clientY-n}),e.addEventListener("mouseup",()=>{t=!1}),e.addEventListener("mousemove",o=>{t&&(d=o.clientX-a,n=o.clientY-s,e.style.transform=`translate(${d}px, ${n}px)`)}),e.addEventListener("mouseleave",()=>{t=!1})}function S(){const e=p.value/100;h({opacity:e})}function O(){const e=v.value;h({width:`${e}px`})}function R(){const e=document.getElementById("imagePreview"),t=m.querySelector("img");if(!t||!t.src){alert("Выберите водяной знак для применения.");return}const d=e.querySelector(".watermark");d&&d.remove();const n=t.cloneNode(!0);n.classList.add("watermark"),e.appendChild(n);let a=!1,s,o;const r=e.querySelector(".main-image");n.addEventListener("mousedown",c=>{a=!0,e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",i,!1),e.addEventListener("drop",i,!1),r.addEventListener("dragenter",i,!1),r.addEventListener("dragover",i,!1),r.addEventListener("drop",i,!1),r.addEventListener("click",i,!1)}),document.addEventListener("mousemove",c=>{if(s=c.clientX-n.getBoundingClientRect().left,o=c.clientY-n.getBoundingClientRect().top,console.log("left: "+n.getBoundingClientRect().left+", top: "+n.getBoundingClientRect().top),console.log("offsetX: "+s+", offsetY: "+o),console.log("e.clientX: "+c.clientX+", e.clientY: "+c.clientY),!a)return;const g=s,f=o;n.style.left=`${g}px`,n.style.top=`${f}px`,e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",i,!1),e.addEventListener("drop",i,!1),r.addEventListener("dragenter",i,!1),r.addEventListener("dragover",i,!1),r.addEventListener("drop",i,!1),r.addEventListener("click",i,!1)}),document.addEventListener("mouseup",()=>{a=!1,e.addEventListener("dragenter",i,!1),e.addEventListener("dragover",i,!1),e.addEventListener("drop",i,!1),r.addEventListener("dragenter",i,!1),r.addEventListener("dragover",i,!1),r.addEventListener("drop",i,!1),r.addEventListener("click",i,!1)})}function i(e){e.preventDefault(),e.stopPropagation()}function q(){const e=document.getElementById("imagePreview"),t=e.querySelector(".main-image"),d=e.querySelectorAll(".watermark");if(!t){alert("Загрузите изображение перед экспортом.");return}const n=document.createElement("canvas"),a=n.getContext("2d");n.width=t.naturalWidth,n.height=t.naturalHeight,a.drawImage(t,0,0),d.forEach(r=>{const c=parseInt(r.style.left)||0,g=parseInt(r.style.top)||0,f=parseFloat(r.style.opacity)||1,y=parseFloat(r.style.width)||r.naturalWidth,w=y/r.naturalWidth*r.naturalHeight;a.globalAlpha=f,a.drawImage(r,c,g,y,w),a.globalAlpha=1});const s=n.toDataURL("image/png"),o=document.createElement("a");o.href=s,o.download="watermarked_image.png",o.click()}
